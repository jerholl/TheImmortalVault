<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creature Feature Lab — The Immortal Vault</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1MSCZ5M4Z4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1MSCZ5M4Z4');
    </script>
    <meta name="description" content="Read Creature Feature Lab, The Immortal Vault journal featuring horror production notes, filmmaking insights, and new story dispatches.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://theimmortalvault.com/dispatch">
    <meta name="theme-color" content="#060606">
    <meta property="og:site_name" content="The Immortal Vault">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Creature Feature Lab — The Immortal Vault">
    <meta property="og:description" content="Explore Creature Feature Lab posts from The Immortal Vault.">
    <meta property="og:url" content="https://theimmortalvault.com/dispatch">
    <meta property="og:image" content="https://theimmortalvault.com/Story.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Creature Feature Lab — The Immortal Vault">
    <meta name="twitter:description" content="Horror dispatches, production insights, and updates from The Immortal Vault.">
    <meta name="twitter:image" content="https://theimmortalvault.com/Story.png">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=DM+Serif+Display:ital@0;1&family=Inter:wght@300;400;500&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #060606; --dark: #0c0c0c; --surface: #111;
            --border: #1c1c1c; --red: #8b0000; --red2: #a31515;
            --text: #d8d4ce; --muted: #4a4a4a;
            --mono: "Share Tech Mono", monospace;
            --serif: "DM Serif Display", serif;
            --sans: "Inter", sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--black); color: var(--text); font-family: var(--sans); line-height: 1.6; overflow-x: hidden; }
        body::after { content: ""; position: fixed; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.025) 2px, rgba(0,0,0,0.025) 4px); pointer-events: none; z-index: 9000; }

        nav { position: sticky; top: 0; z-index: 1000; height: 64px; padding: 0 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); background: var(--black); }
        .nav-logo { color: var(--text); text-decoration: none; text-transform: uppercase; font-family: var(--mono); letter-spacing: 3px; font-size: 0.75rem; }
        .nav-logo::after { content: "_"; color: var(--red2); animation: blink 1.2s step-end infinite; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
        .nav-links { list-style: none; display: flex; gap: 20px; }
        .nav-links a { color: var(--muted); text-decoration: none; text-transform: uppercase; font-family: var(--mono); font-size: 0.58rem; letter-spacing: 2px; transition: color 0.2s; }
        .nav-links a:hover, .nav-links a.active { color: var(--text); }
        .hamburger { display: none; flex-direction: column; gap: 5px; background: none; border: none; cursor: pointer; padding: 4px; }
        .hamburger span { display: block; width: 20px; height: 1px; background: var(--text); transition: all 0.3s; }
        .hamburger.open span:nth-child(1) { transform: translateY(6px) rotate(45deg); background: var(--red2); }
        .hamburger.open span:nth-child(2) { opacity: 0; }
        .hamburger.open span:nth-child(3) { transform: translateY(-6px) rotate(-45deg); background: var(--red2); }
        .mobile-menu { position: fixed; inset: 0; background: var(--black); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 36px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
        .mobile-menu.open { max-height: 100vh; }
        .mobile-menu a { font-family: var(--mono); font-size: 1.1rem; letter-spacing: 4px; text-transform: uppercase; text-decoration: none; color: var(--muted); transition: color 0.2s; }
        .mobile-menu a:hover { color: var(--red2); }

        .page-header { padding: 70px 40px 30px; border-bottom: 1px solid var(--border); }
        .eyebrow { font-family: var(--mono); color: var(--red2); letter-spacing: 4px; text-transform: uppercase; font-size: 0.58rem; margin-bottom: 14px; }
        h1 { font-family: "Montserrat", var(--sans); font-size: clamp(2.3rem, 6vw, 4rem); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; line-height: 1.1; }
        h1 em { color: var(--red2); font-style: normal; }

        .status { margin: 24px 40px 0; color: var(--muted); font-family: var(--mono); font-size: 0.58rem; letter-spacing: 2px; text-transform: uppercase; }

        .posts-grid { margin: 24px 40px 70px; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 1px; background: var(--border); }
        .post-card { background: var(--dark); color: var(--text); text-decoration: none; padding: 26px; min-height: 230px; display: flex; flex-direction: column; gap: 10px; transition: background 0.2s; position: relative; }
        .post-card:hover { background: var(--surface); }
        .post-card::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: var(--red); transform: scaleX(0); transition: transform 0.3s ease; }
        .post-card:hover::before { transform: scaleX(1); }
        .post-card-image {
            width: calc(100% + 52px);
            margin: -26px -26px 14px;
            aspect-ratio: 16 / 9;
            overflow: hidden;
            border-bottom: 1px solid var(--border);
            background: #090909;
        }
        .post-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0.9;
            transition: transform 0.35s ease, opacity 0.35s ease;
        }
        .post-card:hover .post-card-image img {
            transform: scale(1.03);
            opacity: 1;
        }
        .post-date { color: var(--red2); font-family: var(--mono); font-size: 0.5rem; letter-spacing: 2px; text-transform: uppercase; }
        .post-title { font-family: var(--serif); font-size: 1.2rem; line-height: 1.2; }
        .post-excerpt { color: var(--muted); font-size: 0.86rem; line-height: 1.8; flex: 1; }
        .post-read { font-family: var(--mono); font-size: 0.5rem; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); transition: color 0.2s; }
        .post-card:hover .post-read { color: var(--red2); }

        footer { border-top: 1px solid var(--border); padding: 24px 40px; display: flex; justify-content: space-between; color: var(--muted); font-family: var(--mono); font-size: 0.52rem; letter-spacing: 2px; text-transform: uppercase; }

        @media (max-width: 900px) {
            nav, .page-header, footer { padding-left: 22px; padding-right: 22px; }
            .posts-grid, .status { margin-left: 22px; margin-right: 22px; }
            .posts-grid { grid-template-columns: 1fr; }
            .nav-links { display: none; }
            .hamburger { display: flex; }
        }
    </style>
</head>
<body>
    <nav>
        <a href="/" class="nav-logo">The Immortal Vault</a>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/films">Films</a></li>
            <li><a href="/audio-dramas">Audio Dramas</a></li>
            <li><a href="/narrative-fiction">Narrative Fiction</a></li>
            <li><a href="/dispatch" class="active">Creature Feature Lab</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
        </ul>
        <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
    </nav>
    <div class="mobile-menu" id="mobile-menu">
        <a href="/">Home</a>
        <a href="/films">Films</a>
        <a href="/audio-dramas">Audio Dramas</a>
        <a href="/narrative-fiction">Narrative Fiction</a>
        <a href="/dispatch">Creature Feature Lab</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
    </div>

    <header class="page-header">
        <p class="eyebrow">// The Journal</p>
        <h1>Creature <em>Feature Lab</em></h1>
    </header>

    <p class="status" id="status">Loading posts...</p>
    <section class="posts-grid" id="posts"></section>

    <footer>
        <span>The Immortal Vault</span>
        <span>&copy; 2026 — All Works Reserved</span>
    </footer>

    <script>
        const btn = document.getElementById('hamburger');
        const menu = document.getElementById('mobile-menu');
        btn.addEventListener('click', () => { btn.classList.toggle('open'); menu.classList.toggle('open'); });
        menu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => { btn.classList.remove('open'); menu.classList.remove('open'); }));
    </script>

    <script type="module">
        const PROJECT_ID = 'xeqvf5vl';
        const DATASET    = 'production';
        const API_VER    = '2023-10-01';

        const statusEl = document.getElementById('status');
        const postsEl  = document.getElementById('posts');

        // Query: get title, slug, date, and excerpt.
        // coalesce tries the plain 'excerpt' field first,
        // then falls back to extracting plain text from the 'body' block content.
        const query = encodeURIComponent(`
            *[_type == "post"] | order(publishedAt desc) {
                title,
                "slug": slug.current,
                publishedAt,
                "coverImageUrl": coverImage.asset->url,
                "excerpt": coalesce(
                    excerpt,
                    array::join(string::split(pt::text(body), "")[0..200], "")
                )
            }
        `);

        const url = `https://${PROJECT_ID}.api.sanity.io/v${API_VER}/data/query/${DATASET}?query=${query}`;

        try {
            const res   = await fetch(url);
            const data  = await res.json();
            const posts = (data.result || []);

            if (!posts.length) {
                statusEl.textContent = 'No posts published yet.';
            } else {
                statusEl.textContent = `${posts.length} post${posts.length === 1 ? '' : 's'} published`;

                const fmt = d => d
                    ? new Date(d).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })
                    : '';

                postsEl.innerHTML = posts.map(p => `
                    <a class="post-card" href="/dispatch-post?slug=${encodeURIComponent(p.slug)}">
                        ${p.coverImageUrl ? `<div class="post-card-image"><img src="${p.coverImageUrl}" alt="${p.title || 'Post image'}" loading="lazy"></div>` : ''}
                        <div class="post-date">${fmt(p.publishedAt)}</div>
                        <h2 class="post-title">${p.title || 'Untitled post'}</h2>
                        <p class="post-excerpt">${(p.excerpt || '').substring(0, 160)}${p.excerpt && p.excerpt.length > 160 ? '…' : ''}</p>
                        <div class="post-read">Read →</div>
                    </a>
                `).join('');
            }

        } catch(err) {
            console.error('Sanity error:', err);
            statusEl.textContent = 'Unable to load posts — check CORS settings in your Sanity project.';
        }
    </script>
</body>
</html>