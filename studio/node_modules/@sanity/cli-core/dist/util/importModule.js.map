{"version":3,"sources":["../../src/util/importModule.ts"],"sourcesContent":["import {fileURLToPath, pathToFileURL} from 'node:url'\n\nimport {createJiti} from '@rexxars/jiti'\n\nimport {subdebug} from '../debug.js'\n\ninterface ImportModuleOptions {\n  /**\n   * Whether to return the default export of the module.\n   */\n  default?: true\n\n  /**\n   * Path to the tsconfig file to use for the import. If not provided, the tsconfig\n   * will be inferred from the nearest `tsconfig.json` file.\n   */\n  tsconfigPath?: string\n}\n\nconst debug = subdebug('importModule')\n\n/**\n * Imports a module using jiti and returns its exports.\n * This is a thin wrapper around tsx to allow swapping out the underlying implementation in the future if needed.\n *\n * @param filePath - Path to the module to import.\n * @param options - Options for the importModule function.\n * @returns The exported module.\n *\n * @internal\n */\nexport async function importModule<T = unknown>(\n  filePath: string | URL,\n  options: ImportModuleOptions = {},\n): Promise<T> {\n  const {default: returnDefault = true, tsconfigPath} = options\n\n  const jiti = createJiti(import.meta.url, {\n    debug: debug.enabled,\n    tsconfigPaths: typeof tsconfigPath === 'string' ? tsconfigPath : true,\n  })\n\n  const fileURL = typeof filePath === 'string' ? pathToFileURL(filePath) : filePath\n\n  debug(`Loading module: ${fileURLToPath(fileURL)}`, {tsconfigPath})\n\n  return jiti.import<T>(fileURLToPath(fileURL), {default: returnDefault})\n}\n"],"names":["fileURLToPath","pathToFileURL","createJiti","subdebug","debug","importModule","filePath","options","default","returnDefault","tsconfigPath","jiti","url","enabled","tsconfigPaths","fileURL","import"],"mappings":"AAAA,SAAQA,aAAa,EAAEC,aAAa,QAAO,WAAU;AAErD,SAAQC,UAAU,QAAO,gBAAe;AAExC,SAAQC,QAAQ,QAAO,cAAa;AAepC,MAAMC,QAAQD,SAAS;AAEvB;;;;;;;;;CASC,GACD,OAAO,eAAeE,aACpBC,QAAsB,EACtBC,UAA+B,CAAC,CAAC;IAEjC,MAAM,EAACC,SAASC,gBAAgB,IAAI,EAAEC,YAAY,EAAC,GAAGH;IAEtD,MAAMI,OAAOT,WAAW,YAAYU,GAAG,EAAE;QACvCR,OAAOA,MAAMS,OAAO;QACpBC,eAAe,OAAOJ,iBAAiB,WAAWA,eAAe;IACnE;IAEA,MAAMK,UAAU,OAAOT,aAAa,WAAWL,cAAcK,YAAYA;IAEzEF,MAAM,CAAC,gBAAgB,EAAEJ,cAAce,UAAU,EAAE;QAACL;IAAY;IAEhE,OAAOC,KAAKK,MAAM,CAAIhB,cAAce,UAAU;QAACP,SAASC;IAAa;AACvE"}